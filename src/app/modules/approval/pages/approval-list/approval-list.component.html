<div fxLayout="column" style="min-height: 100%">
  <div fxLayout="row" style="width: 100%; min-height: 64px;" class="padding-16">
    <div fxFlex="100%" class="page-title" fxLayout="row wrap" fxLayoutAlign="start center">
      {{'approvalListScreen.title' | translate}}
    </div>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="start start">
    <div fxFlex="100%">
      <mat-tab-group animationDuration="500ms" (selectedIndexChange)="onChangeTabIndex($event)"
        [(selectedIndex)]="selectedTabIndex">
        <mat-tab *ngFor="let tab of shownTabs" [disabled]="loading">
          <ng-template mat-tab-label>
            <span *ngIf="tab.count && tab.count > 0">
              <span [matBadge]="tab.count" matBadgeOverlap="false">{{tab.title | translate }}</span>
            </span>
            <span *ngIf="!tab.count || tab.count <= 0">
              {{tab.title | translate }}
            </span>
          </ng-template>
          <ng-template matTabContent style="min-height: 100%">
            <div [formGroup]="filterForm" fxLayout="row wrap" fxLayoutAlign="start start"
              class="padding-top-16 padding-left-16 padding-right-16">
              <div fxFlex="60%" fxFlex.lt-md="100%" fxLayout="row wrap" fxLayoutAlign="start center"
                ngClass.md="padding-right-16" ngClass.gt-md="padding-right-16">
                <div fxFlex="80%" fxFlex.lt-md="60%" fxFlex.lt-sm="100%" fxLayout="row wrap">
                  <div fxFlex="50%" fxFlex.lt-md="100%" fxLayout="row" fxLayoutAlign="start center">
                    <div fxFlex="40%">
                      {{'table.createdDate' | translate}}
                    </div>
                    <div fxFlex="60%">
                      <mat-form-field appearance="fill">
                        <input matInput #startDateInput [matDatepicker]="startDatepicker" formControlName="startDate"
                          placeholder="{{'forms.schedule.datePlaceholder' | translate}}"
                          (focus)="isFocusedStartDate = true" (blur)="isFocusedStartDate = false">
                        <mat-datepicker-toggle matSuffix [for]="startDatepicker"></mat-datepicker-toggle>
                        <mat-datepicker #startDatepicker class="calendar-mat-icon-button"></mat-datepicker>
                      </mat-form-field>
                      <mat-error class="bottom-error"
                        *ngIf="filterForm.invalid && (filterForm.dirty || filterForm.touched)">
                        <span
                          *ngIf="filterForm.errors.dateRangeRequired">{{'forms.date.errorRangeRequired' | translate}}</span>
                      </mat-error>
                    </div>
                  </div>
                  <div fxFlex="50%" fxFlex.lt-md="100%" fxLayout="row" fxLayoutAlign="start center"
                    ngClass.lt-md="padding-top-8 padding-bottom-16">
                    <div fxFlex="40%" class="padding-left-16 text-center" ngClass.lt-md="text-left">
                      {{'to' | translate}}
                    </div>
                    <div fxFlex="60%">
                      <mat-form-field appearance="fill">
                        <input matInput #endDateInput [matDatepicker]="endDatepicker" formControlName="endDate"
                          placeholder="{{'forms.schedule.datePlaceholder' | translate}}"
                          (focus)="isFocusedEndDate = true" (blur)="isFocusedEndDate = false">
                        <mat-datepicker-toggle matSuffix [for]="endDatepicker"></mat-datepicker-toggle>
                        <mat-datepicker #endDatepicker class="calendar-mat-icon-button"></mat-datepicker>
                      </mat-form-field>
                      <mat-error class="bottom-error"
                        *ngIf="filterForm.invalid && (filterForm.dirty || filterForm.touched)">
                        <span
                          *ngIf="filterForm.errors.dateRangeRequired">{{'forms.date.errorRangeRequired' | translate}}</span>
                      </mat-error>
                    </div>
                  </div>
                </div>
              </div>
              <div fxFlex="40%" fxFlex.lt-md="100%" fxLayout="row" fxLayoutAlign="end center">
                <div fxFlex="70%" fxFlex.lt-lg="85%" fxFlex.lt-md="50%" fxFlex.lt-sm="70%">
                  <mat-form-field appearance="fill" class="font-description search">
                    <mat-icon matPrefix>search</mat-icon>
                    <input formControlName="search" #searchInput matInput
                      placeholder="{{'forms.approvalSearch.placeholder' | translate}}" (focus)="isFocusedSearch = true"
                      (blur)="isFocusedSearch = false">
                  </mat-form-field>
                </div>

              </div>
            </div>
            <div class="border-bottom-gray" fxLayout="row wrap" fxLayoutAlign="end center" class="padding-left-16">
              <mat-paginator [disabled]="loading" [length]="paginatorProps.length" [pageSize]="paginatorProps.pageSize"
                [pageSizeOptions]="paginatorProps.pageSizeOptions"
                [showFirstLastButtons]="paginatorProps.showFirstLastButtons" [pageIndex]="paginatorProps.pageIndex"
                (page)="onPaginatorChange($event)">
              </mat-paginator>
            </div>
            <div class="border-bottom-gray" fxLayout="row wrap" fxLayoutAlign="start center" style="overflow-x: auto">
              <table mat-table [dataSource]="data" class="table-min-100" #table *ngIf="isSelectedTabSpecialOffer()">
                <ng-container matColumnDef="checkbox">
                  <th mat-header-cell *matHeaderCellDef class="font-th th-width-25">
                    <mat-checkbox [disabled]="!allowPublish || loading || data.length === 0" color="primary"
                      (change)="onChangeSelectAll($event)"
                      [indeterminate]="data.length > 0 && selectedRows.length > 0 && selectedRows.length < data.length"
                      [checked]="data.length > 0 && selectedRows.length === data.length">
                    </mat-checkbox>
                  </th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <mat-checkbox [disabled]="!allowPublish" color="primary" (change)="onChangeSelect($event, element)"
                      [checked]="element.isSelected">
                    </mat-checkbox>
                  </td>
                </ng-container>
                <ng-container matColumnDef="title">
                  <th mat-header-cell *matHeaderCellDef class="font-th th-min-width">
                    {{'table.title' | translate}} </th>
                  <td mat-cell *matCellDef="let element">
                    {{element.title}}
                  </td>
                </ng-container>
                <ng-container matColumnDef="preview">
                  <th mat-header-cell *matHeaderCellDef class="font-th th-min-width text-center-important">
                    {{'table.bannersTable.preview' | translate}} </th>
                  <td mat-cell *matCellDef="let element" class="text-center">
                    <img src="{{element.sp_offer_image}}" width="80px" alt="{{'imageNotExist' | translate}}">
                  </td>
                </ng-container>
                <ng-container matColumnDef="endDate">
                  <th mat-header-cell *matHeaderCellDef class="font-th  th-min-width text-center-important">
                    {{'table.bannersTable.endDate' | translate}} </th>
                  <td mat-cell *matCellDef="let element">
                    <div>{{element.end_date | date: 'dd/MM/yyyy HH:mm'}}</div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="createdDate">
                  <th mat-header-cell *matHeaderCellDef class="font-th  th-min-width-50 text-center-important">
                    {{'table.createdDate' | translate}} </th>
                  <td mat-cell *matCellDef="let element">
                    <div>
                      {{element.created_dt | date : 'dd/MM/yyyy HH:mm'}}
                    </div>
                    <div>
                      {{'by' | translate}} {{element.created_by}}
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef class="font-th  th-min-width text-center-important">
                    {{'table.actions' | translate}} </th>
                  <td mat-cell *matCellDef="let element" [class.text-center]="!element.status || element.status === ''">
                    <div *ngIf="allowPublish" class="padding-top-10 padding-bottom-10 success-error-theme">
                      <div style="width: 100%">
                        <button block-button mat-raised-button color="primary"
                          (click)="approveSpecialOffer(element)">{{'approve' | translate}}</button>
                      </div>
                      <div style="width: 100%" class="margin-top-5">
                        <button block-button mat-raised-button color="accent"
                          (click)="rejectSpecialOffer(element)">{{'reject' | translate}}</button>
                      </div>
                    </div>
                    <div *ngIf="!allowPublish" class="padding-top-10 padding-bottom-10">
                      <div style="width: 100%">
                        <button block-button mat-raised-button disabled>{{'approve' | translate}}</button>
                      </div>
                      <div style="width: 100%" class="margin-top-5">
                        <button block-button mat-raised-button disabled>{{'reject' | translate}}</button>
                      </div>
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="detailsLink">
                  <th mat-header-cell *matHeaderCellDef class="font-th  th-min-width-50 text-center-important">
                  </th>
                  <td mat-cell *matCellDef="let element" class="text-center">
                    <a [routerLink]="['/approvals/special-offers', element.id]"
                      class="link-purple cursor-pointer">{{'seeDetails' | translate}}</a>
                  </td>
                </ng-container>
                <tr class="bg-light-gray" mat-header-row *matHeaderRowDef="tab.tableColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: tab.tableColumns;" [hidden]="loading"></tr>
              </table>
            </div>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
  <div fxFlex="grow" style="min-height:100px" fxLayout="row wrap" fxLayoutAlign="center center" *ngIf="loading">
    <div fxLayout="row" fxFlex="100%" fxLayoutAlign="center center">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
    <div fxLayout="row" fxFlex="100%" fxLayoutAlign="center center" class="margin-top-10 font-title">
      {{'loading' | translate}}...
    </div>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="start center" class="margin-top-10 padding-left-16"
    *ngIf="data.length === 0 && !loading">
    <div class="font-gotham-light">
      {{'table.noRecordsFound' | translate}}
    </div>
  </div>
  <div fxLayout="row wrap" fxLayoutAlign="start center" *ngIf="selectedRows.length > 0 && !loading"
    class="padding-16 padding-top-10 padding-bottom-10 border-top-gray bottom-sticky-toolbar">
    <div fxFlex="50%" fxLayout="row wrap" fxLayoutAlign="start center" class="font-gotham-bold font-sub-content">
      <div flexAlign="center" fxLayout="column" fxLayoutAlign="center center">
        <mat-icon class="cursor-pointer" (click)="deselectAll()">clear</mat-icon>
      </div>
      <div flexAlign="center" class="margin-left-10">
        {{'approvalListScreen.totalRowsSelected' | translate: {totalRows: this.selectedRows.length} }}
      </div>
    </div>
    <div fxFlex="50%" fxLayout="row wrap" fxLayoutAlign="end center" class="success-error-theme" *ngIf="allowPublish">
      <div class="margin-right-10">
        <button mat-raised-button color="accent" (click)="rejectSelectedData()">{{'reject' | translate}}</button>
      </div>
      <div class="margin-right-10">
        <button mat-raised-button color="primary" (click)="approveSelectedData()">{{'approve' | translate}}</button>
      </div>
    </div>
    <div fxFlex="50%" fxLayout="row wrap" fxLayoutAlign="end center" *ngIf="!allowPublish">
      <div class="margin-right-10">
        <button mat-raised-button disabled>{{'reject' | translate}}</button>
      </div>
      <div class="margin-right-10">
        <button mat-raised-button disabled>{{'approve' | translate}}</button>
      </div>
    </div>
  </div>
</div>