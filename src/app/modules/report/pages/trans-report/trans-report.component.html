<div fxLayout="column" style="min-height: 100%">
  <div fxLayout="row" style="width: 100%; min-height: 64px;" class="padding-16">
    <div fxFlex="100%" class="page-title" fxLayout="row wrap" fxLayoutAlign="start center">
      {{'transactionReport.title' | translate}}
    </div>
  </div>
  <div [formGroup]="filterForm" fxLayout="row wrap" fxLayoutAlign="start start"
    class="border-bottom-gray padding-left-16 padding-right-16 padding-bottom-16">
    <div fxFlex="60%" fxFlex.lt-md="100%" fxLayout="row wrap" fxLayoutAlign="start center" ngClass.md="padding-right-16"
      ngClass.gt-md="padding-right-16">
      <div fxFlex="80%" fxFlex.lt-md="60%" fxFlex.lt-sm="100%" fxLayout="row wrap">
        <div fxFlex="50%" fxFlex.lt-md="100%" fxLayout="row" fxLayoutAlign="start center">
          <div fxFlex="40%">
            {{'transactionReport.dateFilter' | translate}}
          </div>
          <div fxFlex="60%">
            <mat-form-field appearance="fill">
              <input matInput #startDateInput [matDatepicker]="startDatepicker" formControlName="startDate"
                placeholder="{{'forms.schedule.datePlaceholder' | translate}}" (focus)="isFocusedStartDate = true"
                (blur)="isFocusedStartDate = false" [disabled]="loading">
              <mat-datepicker-toggle matSuffix [for]="startDatepicker"></mat-datepicker-toggle>
              <mat-datepicker #startDatepicker class="calendar-mat-icon-button"></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
        <div fxFlex="50%" fxFlex.lt-md="100%" fxLayout="row" fxLayoutAlign="start center"
          ngClass.lt-md="padding-top-8 padding-bottom-16">
          <div fxFlex="40%" class="padding-left-16 text-center" ngClass.lt-md="text-left">
            {{'to' | translate}}
          </div>
          <div fxFlex="60%">
            <mat-form-field appearance="fill">
              <input matInput #endDateInput [matDatepicker]="endDatepicker" formControlName="endDate"
                placeholder="{{'forms.schedule.datePlaceholder' | translate}}" (focus)="isFocusedEndDate = true"
                (blur)="isFocusedEndDate = false" [disabled]="loading">
              <mat-datepicker-toggle matSuffix [for]="endDatepicker"></mat-datepicker-toggle>
              <mat-datepicker #endDatepicker class="calendar-mat-icon-button"></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
      </div>
    </div>
    <div fxFlex="40%" fxFlex.lt-md="100%" fxLayout="row" fxLayoutAlign="end center">
      <div fxFlex="70%" fxFlex.lt-lg="85%" fxFlex.lt-md="50%" fxFlex.lt-sm="70%">
        <mat-form-field appearance="fill" class="font-description search">
          <mat-icon matPrefix>search</mat-icon>
          <input formControlName="search" #searchInput matInput
            placeholder="{{'forms.transactionSearch.placeholder' | translate}}" [disabled]="loading"
            (focus)="isFocusedSearch = true" (blur)="isFocusedSearch = false">
        </mat-form-field>
        <mat-hint class="bottom-hint">
          {{'forms.transactionSearch.hint' | translate : searchValidation}}
        </mat-hint>
      </div>

    </div>
  </div>
  <div class="border-bottom-gray" fxLayout="row wrap" fxLayoutAlign="start center" class="padding-left-16">
    <div fxFlex="40%" fxFlex.lt-md="100%">
      <a [href]="getDownloadLink()" target="_blank" class="top-action-text" fxLayoutAlign="start center"
        *ngIf="allowDownload && !loading && filterForm.valid && transactions.length > 0; else disabledLink">
        <mat-icon class="font-sub-content-icon margin-right-5">cloud_download</mat-icon>
        <span>
          {{'transactionReport.downloadReport' | translate}}
        </span>
      </a>
      <ng-template #disabledLink>
        <div class="top-action-text disabled" fxLayoutAlign="start center">
          <mat-icon class="font-sub-content-icon margin-right-5">cloud_download</mat-icon>
          <span>
            {{'transactionReport.downloadReport' | translate}}
          </span>
        </div>
      </ng-template>
    </div>
    <div fxFlex="60%" fxFlex.lt-md="100%">
      <mat-paginator [disabled]="loading" [length]="paginatorProps.length" [pageSize]="paginatorProps.pageSize"
        [pageSizeOptions]="paginatorProps.pageSizeOptions" [showFirstLastButtons]="paginatorProps.showFirstLastButtons"
        [pageIndex]="paginatorProps.pageIndex" (page)="onPaginatorChange($event)">
      </mat-paginator>
    </div>
  </div>
  <div class="border-bottom-gray" fxLayout="row wrap" fxLayoutAlign="start center" style="overflow-x: auto">
    <table mat-table [dataSource]="transactions" class="table-min-100" #transactionTable>
      <ng-container matColumnDef="oid">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width">
          {{'table.transactionTable.oid' | translate}}
        </th>
        <td mat-cell *matCellDef="let element">
          {{element.oid}}
        </td>
      </ng-container>
      <ng-container matColumnDef="vaNumber">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width">
          {{'table.transactionTable.vaNumber' | translate}} </th>
        <td mat-cell *matCellDef="let element">
          {{element.va_number}}
        </td>
      </ng-container>
      <ng-container matColumnDef="customerName">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{ 'table.transactionTable.name' | translate }} </th>
        <td mat-cell *matCellDef="let element">
          {{ element.customer_name }}
        </td>
      </ng-container>
      <ng-container matColumnDef="mobileNumber">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width">
          {{'table.transactionTable.phNumber' | translate}} </th>
        <td mat-cell *matCellDef="let element">
          {{ element.mobile_number }}
        </td>
      </ng-container>
      <ng-container matColumnDef="transactionCode">
        <th mat-header-cell *matHeaderCellDef class="font-th  th-min-width-50">
          {{'table.transactionTable.transCode' | translate}} </th>
        <td mat-cell *matCellDef="let element">
            {{element.transaction_code}}
        </td>
      </ng-container>
      <ng-container matColumnDef="transactionType">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-50">
          {{'table.transactionTable.transDesc' | translate}} </th>
        <td mat-cell *matCellDef="let element">
          {{element.transaction_type}}
        </td>
      </ng-container>
      <ng-container matColumnDef="installmentAmount">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.installmentAmount' | translate}} </th>
        <td mat-cell *matCellDef="let element" class="text-right">
          <span *ngIf="element.transaction_type === transactionType.payment">
            {{element.amount | currency:'IDR':'symbol-narrow':'1.2-2': locale}}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="penaltyFee">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.penaltyFee' | translate}}
        </th>
        <td mat-cell *matCellDef="let element" class="text-right">
          <span *ngIf="element.transaction_type === transactionType.payment && element.penalty_fee">
            {{element.penalty_fee | currency:'IDR':'symbol-narrow':'1.2-2': locale}}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="fee">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.fee' | translate}}
        </th>
        <td mat-cell *matCellDef="let element" class="text-right">
          <span *ngIf="element.transaction_type === transactionType.payment && element.fee">
            {{element.fee | currency:'IDR':'symbol-narrow':'1.2-2': locale}}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="withdrawalAmount">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.withdrawalAmount' | translate}}
        </th>
        <td mat-cell *matCellDef="let element" class="text-right">
          <span *ngIf="element.transaction_type === transactionType.withdrawal">
            {{element.amount | currency:'IDR':'symbol-narrow':'1.2-2': locale}}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="withdrawalFee">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.withdrawalFee' | translate}}
        </th>
        <td mat-cell *matCellDef="let element" class="text-right">
          <span *ngIf="element.transaction_type === transactionType.withdrawal">
            {{ element.fee | currency:'IDR':'symbol-narrow':'1.2-2': locale}}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="bankTransferFee">
        <th mat-header-cell *matHeaderCellDef class="font-th  th-min-width-150">
          {{'table.transactionTable.bankTransferFee' | translate}} </th>
        <td mat-cell *matCellDef="let element" class="text-right">
          <span *ngIf="element.edited_date && element.edited_by">
            {{element.bank_admin_fee | currency:'IDR':'symbol-narrow':'1.2-2': locale}}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="ppn">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.ppn' | translate}} </th>
        <td mat-cell *matCellDef="let element" class="text-right">
          <span>{{element.ppn | currency:'IDR':'symbol-narrow':'1.2-2': locale}}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="topUpAmount">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.topUpAmount' | translate}} </th>
        <td mat-cell *matCellDef="let element" class="text-right">
          <span *ngIf="element.transaction_type === transactionType.topUp">
            {{element.amount | currency:'IDR':'symbol-narrow':'1.2-2': locale}}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="transactionSequence">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.transSeq' | translate}}
        </th>
        <td mat-cell *matCellDef="let element">
          {{element.transaction_sequence}}
        </td>
      </ng-container>
      <ng-container matColumnDef="vaName">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width">
          {{'table.transactionTable.vaName' | translate}} </th>
        <td mat-cell *matCellDef="let element">
          {{ element.va_name }}
        </td>
      </ng-container>
      <ng-container matColumnDef="sourceVa">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.sourceVANumber' | translate}} </th>
        <td mat-cell *matCellDef="let element">
          <span *ngIf="element.transaction_type !== transactionType.topUp">
            {{ element.source_va }}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="destinationVa">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.destVANumber' | translate}} </th>
        <td mat-cell *matCellDef="let element">
          <span *ngIf="element.transaction_type !== transactionType.withdrawal">
            {{ element.destination_va }}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="transactionDate">
        <th mat-header-cell *matHeaderCellDef class="font-th th-min-width-150">
          {{'table.transactionTable.transDate' | translate}} </th>
        <td mat-cell *matCellDef="let element">
          {{element.transaction_date | date : 'dd/MM/yyyy ; HH:mm:ss'}}
        </td>
      </ng-container>
      <tr class="bg-light-gray" mat-header-row *matHeaderRowDef="transactionColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: transactionColumns;" [hidden]="loading"></tr>
    </table>
  </div>
  <div fxFlex="grow" style="min-height:100px" fxLayout="row wrap" fxLayoutAlign="center center" *ngIf="loading">
    <div fxLayout="row" fxFlex="100%" fxLayoutAlign="center center">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
    <div fxLayout="row" fxFlex="100%" fxLayoutAlign="center center" class="margin-top-10 font-title">
      {{'loading' | translate}}...
    </div>
  </div>
  <div fxFlex="grow" style="min-height:150px" fxLayout="row wrap" fxLayoutAlign="center center" 
  *ngIf="!loading && filterForm.invalid">
      <div fxLayout="row" fxFlex="100%" fxLayoutAlign="center center">
        <mat-icon class="error-icon text-gray">error</mat-icon>
      </div>
      <div fxLayout="row" fxFlex="100%" fxLayoutAlign="center center" class="margin-top-10 font-sub-content text-medium-gray">
        {{'transactionReport.filterNotSet' | translate}}
      </div>
    </div>
  <div fxLayout="row wrap" fxLayoutAlign="start center" class="margin-top-10 padding-left-16"
    *ngIf="transactions.length === 0 && !loading && filterForm.valid">
    <div class="font-gotham-light">
      {{'table.noRecordsFound' | translate}}
    </div>
  </div>
</div>